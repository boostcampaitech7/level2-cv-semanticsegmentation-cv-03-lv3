# Hand Bone Image Segmentation

## ğŸ¥‡ íŒ€ êµ¬ì„±ì›

<div align="center">
<table>
  <tr>
    <td align="center">
      <a href="https://github.com/kupulau">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>í™©ì§€ì€</b></sub><br />
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/asotea">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>ê¹€íƒœê· </b></sub><br />
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/mujjinungae">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>ì´ì§„ìš°</b></sub><br />
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/glasshong">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>í™ìœ ë¦¬</b></sub><br />
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/EuiInSeong">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>ì„±ì˜ì¸</b></sub><br />
      </a>
    </td>
    <td align="center">
      <a href="https://github.com/jinbong-yeom">
        <img src="https://aistages-api-public-prod.s3.amazonaws.com/app/Users/00003808/user_image.png" width="120px" height="120px" alt=""/>
        <hr />
        <sub><b>ì—¼ì§„ë´‰</b></sub><br />
      </a>
    </td>
  </tr>
</table>
</div>

<br />

## ğŸ—’ï¸ í”„ë¡œì íŠ¸ ê°œìš”

ë¼ˆëŠ” ìš°ë¦¬ ëª¸ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥ì— ì¤‘ìš”í•œ ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì—, ì •í™•í•œ ë¼ˆ ë¶„í• ì€ ì˜ë£Œ ì§„ë‹¨ ë° ì¹˜ë£Œ ê³„íšì„ ê°œë°œí•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

Bone Segmentationì€ ì¸ê³µì§€ëŠ¥ ë¶„ì•¼ì—ì„œ ì¤‘ìš”í•œ ì‘ìš© ë¶„ì•¼ ì¤‘ í•˜ë‚˜ë¡œ, íŠ¹íˆ, ë”¥ëŸ¬ë‹ ê¸°ìˆ ì„ ì´ìš©í•œ ë¼ˆ Segmentationì€ ë§ì€ ì—°êµ¬ê°€ ì´ë£¨ì–´ì§€ê³  ìˆìœ¼ë©°, ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. ì§ˆë³‘ ì§„ë‹¨ì˜ ëª©ì ìœ¼ë¡œ ë¼ˆì˜ í˜•íƒœë‚˜ ìœ„ì¹˜ê°€ ë³€í˜•ë˜ê±°ë‚˜ ë¶€ëŸ¬ì§€ê±°ë‚˜ ê³¨ì ˆ ë“±ì´ ìˆì„ ê²½ìš°, ê·¸ ë¶€ìœ„ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•˜ì—¬ ì ì ˆí•œ ì¹˜ë£Œë¥¼ ì‹œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. ìˆ˜ìˆ  ê³„íšì„ ì„¸ìš°ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. ì˜ì‚¬ë“¤ì€ ë¼ˆ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ ì–´ë–¤ ì¢…ë¥˜ì˜ ìˆ˜ìˆ ì´ í•„ìš”í•œì§€, ì–´ë–¤ ì¢…ë¥˜ì˜ ì¬ë£Œê°€ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ”ì§€ ë“±ì„ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. ì˜ë£Œì¥ë¹„ ì œì‘ì— í•„ìš”í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì¸ê³µ ê´€ì ˆì´ë‚˜ ì¹˜ì•„ ì„í”Œë€íŠ¸ë¥¼ ì œì‘í•  ë•Œ ë¼ˆ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ í¬ê¸°ì™€ ëª¨ì–‘ì„ ê²°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4. ì˜ë£Œ êµìœ¡ì—ì„œë„ í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ì‚¬ë“¤ì€ ë³‘íƒœ ë° ë¶€ìƒì— ëŒ€í•œ ì´í•´ë¥¼ ë†’ì´ê³  ìˆ˜ìˆ  ê³„íšì„ ê°œë°œí•˜ëŠ” ë° í•„ìš”í•œ ê¸°ìˆ ì„ ì—°ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ì— ì˜í•´ ë§Œë“¤ì–´ì§„ ìš°ìˆ˜í•œ ì„±ëŠ¥ì˜ ëª¨ë¸ì€ ì§ˆë³‘ ì§„ë‹¨, ìˆ˜ìˆ  ê³„íš, ì˜ë£Œ ì¥ë¹„ ì œì‘, ì˜ë£Œ êµìœ¡ ë“±ì— ì‚¬ìš©ë  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤. ğŸŒ

<br />

## ğŸ“… í”„ë¡œì íŠ¸ ì¼ì •

í”„ë¡œì íŠ¸ ì „ì²´ ì¼ì •

- 2024.11.11 (ì›”) 10:00 ~ 2024.11.28 (ëª©) 19:00

í”„ë¡œì íŠ¸ ì„¸ë¶€ ì¼ì •

![schedule](https://github.com/user-attachments/assets/fad69118-9c1d-4c84-884f-d74df9e8c543)

## ğŸ’» ê°œë°œ í™˜ê²½

```bash
- Language : Python
- Environment
  - CPU : Intel(R) Xeon(R) Gold 5120
  - GPU : Tesla V100-SXM2 32GB Ã— 1
- Framework : PyTorch
- Collaborative Tool : Git, Wandb, Notion
```

## ğŸ“ ë°ì´í„°ì…‹ êµ¬ì¡°

```
ğŸ“¦data
  â”œâ”€ğŸ“‚test
  â”‚    â””â”€ğŸ“‚DCM
  â”‚         â”œâ”€ğŸ“‚ID040
  â”‚         â”‚     ğŸ“œimage1661319116107.png
  â”‚         â”‚     ğŸ“œimage1661319145363.png
  â”‚         â””â”€ğŸ“‚ID041
  â”‚               ğŸ“œimage1661319356239.png
  â”‚               ğŸ“œimage1661319390106.png
  â”‚
  â”œâ”€ğŸ“‚train
  â”‚    â”œâ”€ğŸ“‚DCM
  â”‚    â”‚   â”œâ”€ğŸ“‚ID001
  â”‚    â”‚   â”‚     ğŸ“œimage1661130828152_R.png
  â”‚    â”‚   â”‚     ğŸ“œimage1661130891365_L.png
  â”‚    â”‚   â””â”€ğŸ“‚ID002
  â”‚    â”‚         ğŸ“œimage1661144206667.png
  â”‚    â”‚         ğŸ“œimage1661144246917.png
  â”‚    â”‚        
  â”‚    â””â”€ğŸ“‚outputs_json
  â”‚               â”œâ”€ğŸ“‚ID001
  â”‚               â”‚     ğŸ“œimage1661130828152_R.json
  â”‚               â”‚     ğŸ“œimage1661130891365_L.json
  â”‚               â””â”€ğŸ“‚ID002
                        ğŸ“œimage1661144206667.json
                        ğŸ“œimage1661144246917.json
```

- í•™ìŠµì— ì‚¬ìš©í•  ì´ë¯¸ì§€ëŠ” 800ê°œ, ì¶”ë¡ ì— ì‚¬ìš©í•  ì´ë¯¸ì§€ëŠ” 288ê°œë¡œ ê°ê° data/train/, data/test ì•„ë˜ì— ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- ì œê³µë˜ëŠ” ì´ë¯¸ì§€ ë°ì´í„°ì…‹ì€ ì†ê°€ë½, ì†ë“±, íŒ” ë¶€ìœ„ì˜ 29ê°œ ì¢…ë¥˜ì˜ ë¼ˆê°€ ì°íŒ 2048 x 2048 í¬ê¸°ì˜ ì‚¬ì§„ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- json íŒŒì¼ì€ ê° í•™ìŠµ ì´ë¯¸ì§€ì˜ ë¼ˆ ì¢…ë¥˜ë¥¼ êµ¬ë¶„í•œ annotation fileì…ë‹ˆë‹¤.

<br />

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° 

```
ğŸ“¦level2-cv-semanticsegmentation-cv-03-lv3
 â”£ ğŸ“‚.github
 â”ƒ â”— ğŸ“‚ISSUE_TEMPLATE
 â”ƒ   â”— ğŸ“œbug_report_template.yaml
 â”ƒ   â”— ğŸ“œdocumentation_issue_template.yaml
 â”ƒ   â”— ğŸ“œenhancement_request_template.yaml
 â”ƒ   â”— ğŸ“œfeature_request_template.yaml
 â”ƒ â”— ğŸ“œ.keep
 â”ƒ â”— ğŸ“œpull_request_templat.md
 â”£ ğŸ“‚EDA
 â”ƒ â”— ğŸ“œEDA.ipynb
 â”£ ğŸ“‚baseline
 â”ƒ â”— ğŸ“‚config
 â”ƒ   â”— ğŸ“œbase_config.yaml
 â”ƒ   â”— ğŸ“œsetting.txt
 â”ƒ â”— ğŸ“‚utils
 â”ƒ   â”— ğŸ“‚ensemble_input
 â”ƒ     â”— ğŸ“œ9542.csv
 â”ƒ     â”— ğŸ“œ9680.csv
 â”ƒ   â”— ğŸ“‚wandb
 â”ƒ     â”— ğŸ“œwandb.ipynb
 â”ƒ   â”— ğŸ“œclasswise_ensemble.py
 â”ƒ   â”— ğŸ“œcrop_to_2048.ipynb
 â”ƒ   â”— ğŸ“œearly_stop.py
 â”ƒ   â”— ğŸ“œhard_ensemble.py
 â”ƒ   â”— ğŸ“œvisualize_test.ipynb
 â”ƒ   â”— ğŸ“œvisualize_train.ipynb
 â”ƒ   â”— ğŸ“œwandb.py
 â”ƒ â”— ğŸ“œdataset.py
 â”ƒ â”— ğŸ“œinference.py
 â”ƒ â”— ğŸ“œloss.py
 â”ƒ â”— ğŸ“œmodel.py
 â”ƒ â”— ğŸ“œmodel_tk.py
 â”ƒ â”— ğŸ“œmodel_ui.py
 â”ƒ â”— ğŸ“œscheduler.py
 â”ƒ â”— ğŸ“œtrain.py
 â”£ ğŸ“‚baseline_monai/cv-03
 â”ƒ â”— ğŸ“‚configs
 â”ƒ   â”— ğŸ“œbase_train.yaml
 â”ƒ â”— ğŸ“‚loss
 â”ƒ   â”— ğŸ“œbase_loss.py
 â”ƒ   â”— ğŸ“œloss_selector.py
 â”ƒ â”— ğŸ“‚models
 â”ƒ   â”— ğŸ“œbase_model.py
 â”ƒ   â”— ğŸ“œmodel_selector.py
 â”ƒ   â”— ğŸ“œmonai_unet.py
 â”ƒ   â”— ğŸ“œmonai_unetplusplus.py
 â”ƒ â”— ğŸ“‚scheduler
 â”ƒ   â”— ğŸ“œscheduler_selector.py
 â”ƒ â”— ğŸ“‚utils
 â”ƒ   â”— ğŸ“œwandb.py
 â”ƒ â”— ğŸ“œdataset.py
 â”ƒ â”— ğŸ“œinference.py
 â”ƒ â”— ğŸ“œtrain.py
 â”ƒ â”— ğŸ“œtrainer.py
 â”£ ğŸ“œ.gitignore
 â”£ ğŸ“œCapitate_crop.ipynb
 â”£ ğŸ“œREADME.md
 â”£ ğŸ“œSAM_sample.ipynb
```

### baseline code ì„¤ëª…

#### 1) `train.py`

- argparseë¥¼ í†µí•´ ì„¤ì • ê°’ì„ ë°›ì•„ ëª¨ë¸ í•™ìŠµì„ ìˆ˜í–‰í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

#### 2) `model.py`

- ëª¨ë¸ì„ ì •ì˜í•œ íŒŒì¼
- Model_Selector í´ë˜ìŠ¤ë¡œ UNet++, DeepLabV3 ë“±ì˜ ëª¨ë¸ ì„ íƒ ê°€ëŠ¥

#### 3) `inference.py`

- í•™ìŠµëœ ëª¨ë¸ì„ ë¶ˆëŸ¬ì™€ ì˜ˆì¸¡ê°’ì„ ë°˜í™˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

#### 4) `dataset.py`

- í•™ìŠµ ë° ì¶”ë¡  ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì •ì˜í•œ íŒŒì¼

#### 5) `loss.py`

- í•™ìŠµ ì‹œì— ì‚¬ìš©í•˜ëŠ” ë‹¤ì–‘í•œ lossë¥¼ ì •ì˜í•˜ê³  ì„ íƒí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

#### 6) `scheduler.py`

- í•™ìŠµ ì‹œì— ì‚¬ìš©í•˜ëŠ” ë‹¤ì–‘í•œ schedulerë¥¼ ì •ì˜í•˜ê³  ì„ íƒí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

<br />

## âš™ï¸ requirements

- opencv-python-headless==4.10.0.84
- pandas==2.2.3
- scikit-learn==1.5.2
- albumentations==1.4.18
- matplotlib==3.9.2
- os
- random
- datetime
- cv2
- numpy
- tqdm
- omegaconf
- argparse
- torch
- wandb

`pip install -r requirements.txt`

<br />

## â–¶ï¸ ì‹¤í–‰ ë°©ë²•

#### í•™ìŠµ ë° ì²´í¬í¬ì¸íŠ¸ ì €ì¥

`python train.py --config base_config.yaml`

#### ì¶”ë¡ 

`python inference.py --config base_config.yaml`

#### `base_config.yaml` ì„¤ëª…

<details>
<summary>í´ë¦­í•´ì„œ í¼ì¹˜ê¸°/ì ‘ê¸°</summary>

1. **`Data root`**:
   - **ì„¤ëª…**: í•™ìŠµ ì´ë¯¸ì§€, annotation ë°ì´í„°ê°€ ì €ì¥ëœ ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: image_root: `/data/ephemeral/home/level2-cv-semanticsegmentation-cv-03-lv3/data/train/DCM`
              label_root: `/data/ephemeral/home/level2-cv-semanticsegmentation-cv-03-lv3/data/train/outputs_json`

2. **`Hyperparameter`**:

   - **ì„¤ëª…**: í•™ìŠµ ì‹œ ì‚¬ìš©ë˜ëŠ” í•˜ì´í¼ íŒŒë¼ë¯¸í„°(ë°°ì¹˜ ì‚¬ì´ì¦ˆ, í•™ìŠµë¥ , random seed)ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: train_batch_size: 4
              val_batch_size: 2
              learning_rate: 1e-4
              random_seed: 42

3. **`Train`**:

   - **ì„¤ëª…**: í•™ìŠµ ì‹œ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸, epoch, validation ì£¼ê¸°, ì†ì‹¤ í•¨ìˆ˜, ìŠ¤ì¼€ì¤„ëŸ¬, ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆ, accumulation step, patienceë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: model: 'unetplusplus'
              num_epoch: 60
              val_every: 5
              loss: 'diceiou_loss'
              scheduler: 'CosineAnnealingWarmRestarts'
              image_size: 1024
              accumulation_steps: 4
              patience: 3

4. **`Test`**:

   - **ì„¤ëª…**: ì¶”ë¡  ì´ë¯¸ì§€ê°€ ì €ì¥ëœ ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: test_image_root: "/data/ephemeral/home/level2-cv-semanticsegmentation-cv-03-lv3/data/test/DCM"

5. **`Save directory`**:

   - **ì„¤ëª…**: í•™ìŠµëœ ëª¨ë¸, ì¶”ë¡  ê²°ê³¼ë¥¼ ì €ì¥í•  ê²½ë¡œì™€ íŒŒì¼ ì´ë¦„ì„ ì„¤ì •í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: save_dir: "checkpoints"
              save_file_name: "unet++_diceiou_best_model.pt"
              csv_file_name: "output_unet++_diceiou.csv"

6. **`Project name`**:

   - **ì„¤ëª…**: ì‹¤í—˜ ì£¼ì œì™€ ì„¤ëª…ì„ ê¸°ìˆ í•©ë‹ˆë‹¤.
   - **ì˜ˆì‹œ**: project_name: 'ì‹¤í—˜ ì£¼ì œ'
              detail: 'ì„¸ë¶€ ë‚´ìš©'

</details>

<br />